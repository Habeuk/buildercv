"use strict";(("undefined"!==typeof self?self:this)["webpackChunkBuilderCv"]=("undefined"!==typeof self?self:this)["webpackChunkBuilderCv"]||[]).push([[936],{5936:function(e,t,s){s.r(t),s.d(t,{default:function(){return z}});var a=function(){var e=this,t=e._self._c;return t("ValidationObserver",{ref:"formValidate",attrs:{tag:"form"}},[t("div",{staticClass:"login-page"},[e.alertDisplay?t("div",{staticClass:"alert w-100",class:e.alertType,attrs:{role:"alert"},domProps:{innerHTML:e._s(e.alertText)}}):e._e(),e.isBusy?t("div",{staticClass:"spinner-grow text-primary",staticStyle:{width:"3rem",height:"3rem"},attrs:{role:"status"}},[t("span",{staticClass:"sr-only"},[e._v("Chargement ...")])]):e._e(),t("transition",{attrs:{name:"customslide"}},[t("div",{staticClass:"block-center"},[t(e.stepe,{tag:"component",attrs:{urlLogo:e.urlLogo,form:e.form,formValidate:e.formValidate,action_after_login:e.action_after_login,model_register_form:e.model_register_form},on:{"select-stepe":e.selectStepe}})],1)])],1),t("div",{staticClass:"politik-secur mx-auto text-center"},[e._t("condition_utilisation",(function(){return[t("p",{staticClass:"text-white"},[e._v(" En vous inscrivant, vous acceptez nos "),t("a",{attrs:{href:"#"}},[e._v(" Conditions d'utilisation ")]),e._v(", de recevoir des emails et des MAJ de LESROISDELARENO et vous reconnaissez avoir lu notre "),t("a",{attrs:{href:"#"}},[e._v(" Politique de confidentialité")])])]}))],2)])},o=[],i=(s(7658),s(7203)),r=s.n(i),n=s(5389),l={AfterRedirect(e,t=null,s=null){console.log("AfterRedirect action .",e);var a=null;if("redirect"==e&&t);else if("home"==e)window.location.assign("/");else if("reload"==e)window.location.reload(),console.log("reload this page");else if("emit_even"==e){var o=new CustomEvent("login_rx_vuejs__user_is_login");document.dispatchEvent(o)}else"default"==e&&(s.reponse&&s.reponse.config.url!==s.reponse.request.responseURL?window.location.assign(s.reponse.request.responseURL):s.data&&s.data.createuser?a="final-gl-register":s.data&&window.location.reload());return a}};const c=new(r());var u={...l,messages:{log_email:"Email ou Nom d'utilisateur",pass:"Mot de passe",login:"Nom d'utilisateur",mail:"Email",submit:{first:"Suivant",connect:"Connexion",register:"S'inscrire",final:"terminée"},devisCreateUser:"Votre compte a été creer sur <a href='/'> lesroisdelareno.fr </a>. <br> <strong> Bien vouloir verifier votre boite mail afin de valider votre compte </strong>"},modalSuccess(e,t){return n.Ht.modalSuccess(e,t)},msgCreate(e){var t=c.$createElement;const s=[];for(const a in e)s.push(t("p",{domProps:{innerHTML:e[a]},style:{lineHeight:"25px",fontSize:"17px",padding:"15px 15px 0px",margin:0}},[]));return t("div",{},[s])}},d=s(4373),m=s(1232),g={user:{},FB:null,appId:"",scope:"public_profile, email",version:"v11.0",openPopup(){var e=this;window.FB.login((e=>{this.statusChangeCallback(e,!0)}),{scope:e.scope,return_scopes:!0})},logOut(){window.FB.logout((function(e){this.onLogOut(e)}))},onLogOut(e){console.log("Déconnetion réussi",e)},statusChangeCallback(e,t=!1){if(this.user=e,t){var s=new CustomEvent("wbu-fb-status-change");document.dispatchEvent(s)}console.log("status",this.user)},getUserStatus(){var e=this;window.FB.getLoginStatus((function(t){e.statusChangeCallback(t)}))},chargement(){var e=this,t=document.getElementsByTagName("head")[0],s=document.createElement("script");t.appendChild(s),s.id="facebook-jssdk-021",s.onload=function(){function t(){window.FB?(e.FB=window.FB,e.FB.init({appId:e.appId,cookie:!0,xfbml:!0,version:e.version,statue:!1}),console.log("Chargement du JS facebook"),e.getUserStatus()):(console.log("facebook not load"),setTimeout((()=>{t()}),900))}t()},s.src="https://connect.facebook.net/en_US/sdk.js"}},p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content-center"},[t("a",{staticClass:"content-center__img",attrs:{href:"/"}},[t("img",{staticClass:"img-fluid",attrs:{src:e.urlLogo,alt:""}})]),t("h4",{staticClass:"title"},[e._v("Connectez vous avec")]),t("div",{staticClass:"content-center__btn-column"},[t("logingoogle",{attrs:{idHtml:"default"}}),t("div",{staticClass:"btn-login btn-login--facebook",on:{click:e.loginFacebook}},[t("span",{staticClass:"btn-login__icon icon-facebook"}),t("i",{staticClass:"btn-login__text"},[e._v(" Facebook ")]),"facebook"===e.waiting?t("svgWaiting"):e._e()],1)],1),t("strong",{staticClass:"d-block"},[e._v(" Ou ")]),t("hr",{staticClass:"diviseur"}),t("h3",{staticClass:"content-center__title"},[e._v(e._s(e.messages.log_email))]),t("div",{staticClass:"form-group content-center__input"},[t("ValidationProvider",{attrs:{name:"name",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.name[0].value,expression:"form.name[0].value"}],staticClass:"form-control",attrs:{type:"text",name:"name"},domProps:{value:e.form.name[0].value},on:{input:function(t){t.target.composing||e.$set(e.form.name[0],"value",t.target.value)}}}),t("div",{staticClass:"text-danger text-small"},e._l(s.errors,(function(s,a){return t("small",{key:a,staticClass:"d-block"},[e._v(" "+e._s(s)+" ")])})),0)]}}])})],1),t("div",{staticClass:"content-center__btn"},[t("div",{staticClass:"btn-login btn-login--connexion",on:{click:e.checkUserStatus}},[t("span",{staticClass:"btn-login__text"},[e._v(" "+e._s(e.messages.submit.first)+" ")]),"wait"===e.waiting?t("svgWaiting"):e._e()],1)])])},f=[],h=function(){var e=this,t=e._self._c;return t("div",{staticClass:"buttton-google-aouth",class:e.classRender,attrs:{id:e.idHtmlrender}})},v=[],_={userAccess:{},client_id:"513247959752-qapd9jb30pdtoh51m0h53070a2v8c4er.apps.googleusercontent.com"};function w(e){return new Promise((t=>{var s=document.createElement("script");s.setAttribute("src",e),s.onload=function(){console.log(" Chargement du script ok : ",e),t(!0)},document.head.appendChild(s)}))}var b={name:"logingoogle",props:{idHtml:{type:String,required:!0},returnUidInfo:{type:Boolean,default:!1},classRender:{type:Array,default:function(){return["mx-auto"]}},action_after_login:{type:String,default:"default"}},mounted(){window.google?this.getUserInfoFromFrame():w("https://accounts.google.com/gsi/client").then((()=>{this.getUserInfoFromFrame()}))},computed:{idHtmlrender(){return"google-login-tab"+this.idHtml}},methods:{getUserInfoFromFrame(){var e=this;function t(t){console.log("Encoded JWT ID token: ",t),_.userAccess={...t,client_id:t.clientId},e.TryToLoginWithGoogle(),window.rxGoogle=_}console.log(" window.onload ! ",window.onload);const s=()=>{window.google.accounts.id.initialize({client_id:_.client_id,callback:t}),window.google.accounts.id.renderButton(document.getElementById(e.idHtmlrender),{theme:"outline",size:"large"}),window.google.accounts.id.prompt()};s()},TryToLoginWithGoogle(){return new Promise(((e,t)=>{m.Z.post("/login-rx-vuejs/google-check",_.userAccess).then((t=>{this.isBusy=!1,this.alertDisplay=!0,this.alertType="alert-success",this.alertText="Connexion réussie",this.$emit("ev_logingoogle",t.data),this.returnUidInfo||l.AfterRedirect(this.action_after_login,null,t),e(t)})).catch((e=>{this.isBusy=!1,this.alertDisplay=!0,this.alertType="alert-danger",this.alertText="Google : Erreur de connexion",e.error&&e.error.statusText&&""!=e.error.statusText&&(this.alertText=e.error.statusText),console.log(" Error ajax ",e.error),console.log(" Error ajax ",e.code),console.log(" Error ajax ",e.stack),t(e)}))}))}}},C=b,y=s(1001),x=(0,y.Z)(C,h,v,!1,null,null,null),k=x.exports,S={name:"checkstatus",props:{urlLogo:{type:String,required:!0},form:{type:Object,required:!0},formValidate:{type:Object,required:!0}},components:{svgWaiting:()=>s.e(324).then(s.bind(s,5324)),logingoogle:k},data(){return{messages:u.messages,waiting:""}},methods:{loginFacebook(){this.waiting="facebook",g.openPopup()},logOutFacebook(){g.logOut()},async checkUserStatus(){this.waiting="wait";var e="/login-rx-vuejs/check-user-status";const t=await this.formValidate.validate();t?m.Z.post(e,this.form).then((e=>{this.waiting="",e.data?this.$emit("select-stepe","setPassword"):this.$emit("select-stepe","register")})):this.waiting=""}}},T=S,F=(0,y.Z)(T,p,f,!1,null,null,null),E=F.exports,L=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content-center"},[t("a",{staticClass:"content-center__img",attrs:{href:"/"}},[t("img",{attrs:{src:e.urlLogo,alt:""}})]),t("h3",{staticClass:"content-center__title"},[e._v(e._s(e.messages.pass))]),t("div",{staticClass:"form-group content-center__input"},[t("ValidationProvider",{ref:"refPass",attrs:{name:"pass",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(s){return[e.form.password?t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.password[0].value,expression:"form.password[0].value"}],staticClass:"form-control",attrs:{type:"password",name:"pass"},domProps:{value:e.form.password[0].value},on:{input:function(t){t.target.composing||e.$set(e.form.password[0],"value",t.target.value)}}}):e._e(),t("div",{staticClass:"text-danger text-small"},e._l(s.errors,(function(s,a){return t("small",{key:a,staticClass:"d-block"},[e._v(" "+e._s(s)+" ")])})),0)]}}])})],1),t("a",{staticClass:"content-center__forgot-pass",attrs:{href:"/user/password"}},[e._v(" Mot de passe oublié ? ")]),t("div",{staticClass:"content-center__btn"},[t("div",{staticClass:"btn-login btn-login--connexion",on:{click:e.Login}},[t("span",{staticClass:"btn-login__text"},[e._v(" "+e._s(e.messages.submit.connect)+" ")]),"wait"==e.waiting?t("svgWaiting"):e._e()],1)]),t("hr"),t("a",{staticClass:"text-center d-block",attrs:{href:"#"},on:{click:function(t){return e.$emit("select-stepe","checkstatus")}}},[e._v(" Retour ")])])},P=[],B={name:"checkstatus",props:{urlLogo:{type:String,required:!0},form:{type:Object,required:!0},formValidate:{type:Object,required:!0},action_after_login:{type:String,required:!0}},components:{svgWaiting:()=>s.e(324).then(s.bind(s,5324))},data(){return{messages:u.messages,waiting:""}},mounted(){void 0===this.form.password&&this.$set(this.form,"password",[{value:""}])},methods:{async Login(){this.waiting="wait";var e="/login-rx-vuejs/user-connexion";const t=await this.formValidate.validate();setTimeout((()=>{t?m.Z.post(e,this.form).then((e=>{this.waiting="",u.AfterRedirect(this.action_after_login,null,e)})).catch((e=>{this.$refs.refPass.setErrors([e.error.statusText]),this.waiting="error"})):this.waiting=""}),3e3)}}},q=B,V=(0,y.Z)(q,L,P,!1,null,null,null),R=V.exports,j=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content-center"},[t("a",{staticClass:"content-center__img",attrs:{href:"/"}},[t("img",{attrs:{src:e.urlLogo,alt:""}})]),"default"===e.model_register_form?t("div",[t("h3",{staticClass:"content-center__title"},[e._v(e._s(e.messages.login))]),t("div",{staticClass:"form-group content-center__input"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.name[0].value,expression:"form.name[0].value"}],staticClass:"form-control",attrs:{type:"text",readonly:"true",name:"name"},domProps:{value:e.form.name[0].value},on:{input:function(t){t.target.composing||e.$set(e.form.name[0],"value",t.target.value)}}})]),e.showPassword?t("h3",{staticClass:"content-center__title"},[e._v(" "+e._s(e.messages.pass)+" ")]):e._e(),e.showPassword?t("div",{staticClass:"form-group content-center__input"},[e.form.password?t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.password[0].value,expression:"form.password[0].value"}],staticClass:"form-control",attrs:{type:"password",name:"pass"},domProps:{value:e.form.password[0].value},on:{input:function(t){t.target.composing||e.$set(e.form.password[0],"value",t.target.value)}}}):e._e()]):e._e(),t("h3",{staticClass:"content-center__title"},[e._v(e._s(e.messages.mail))]),t("ValidationProvider",{ref:"mail",staticClass:"d-block w-100",attrs:{name:"mail",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticClass:"form-group content-center__input"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.mail[0].value,expression:"form.mail[0].value"}],staticClass:"form-control",attrs:{type:"mail",name:"mail"},domProps:{value:e.form.mail[0].value},on:{input:function(t){t.target.composing||e.$set(e.form.mail[0],"value",t.target.value)}}})]),t("div",{staticClass:"text-danger text-small"},e._l(s.errors,(function(s,a){return t("small",{key:a,staticClass:"d-block"},[e._v(" "+e._s(s)+" ")])})),0)]}}],null,!1,3187930093)}),e._l(e.templates,(function(s,a){return t("ValidationProvider",{key:a,ref:s.ref,refInFor:!0,staticClass:"d-block w-100",scopedSlots:e._u([{key:"default",fn:function(a){return[t(s,{tag:"component"}),t("div",{staticClass:"text-danger text-small"},e._l(a.errors,(function(s,a){return t("small",{key:a,staticClass:"d-block"},[e._v(" "+e._s(s)+" ")])})),0)]}}],null,!0)})})),t("div",{staticClass:"content-center__btn"},[t("div",{staticClass:"btn-login btn-login--connexion",on:{click:e.RegisterDefault}},[t("span",{staticClass:"btn-login__text"},[e._v(" "+e._s(e.messages.submit.register)+" ")]),"wait"==e.waiting?t("svgWaiting"):e._e()],1)]),t("hr")],2):e._e(),"generate_password"===e.model_register_form?t("div",[t("h4",{staticClass:"title"},[e._v("Creation automatique du compte")]),t("p",{staticClass:"mb-4"},[e._v(" Vos informations de connexion seront transferés à cette adresse. ")]),e.validEmail(e.form.name[0].value)?t("div",{staticClass:"mb-5"},[t("strong",[e._v(" "+e._s(e.form.name[0].value)+" ")]),e._v(" "+e._s(e.set_email())+" ")]):e._e(),e.validEmail(e.form.name[0].value)?e._e():t("div",[t("ValidationProvider",{ref:"mail",staticClass:"d-block w-100",attrs:{name:"mail",rules:"required"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",{staticClass:"form-group content-center__input"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.mail[0].value,expression:"form.mail[0].value"}],staticClass:"form-control",attrs:{type:"mail",name:"mail"},domProps:{value:e.form.mail[0].value},on:{input:function(t){t.target.composing||e.$set(e.form.mail[0],"value",t.target.value)}}})]),t("div",{staticClass:"text-danger text-small"},e._l(s.errors,(function(s,a){return t("small",{key:a,staticClass:"d-block"},[e._v(" "+e._s(s)+" ")])})),0)]}}],null,!1,3187930093)})],1),t("div",{staticClass:"content-center__btn"},[t("div",{staticClass:"btn-login btn-login--connexion",on:{click:e.generatePassword}},[t("span",{staticClass:"btn-login__text"},[e._v(" "+e._s(e.messages.submit.register)+" ")]),"wait"==e.waiting?t("svgWaiting"):e._e()],1)])]):e._e(),t("a",{staticClass:"text-center d-block",attrs:{href:"#"},on:{click:function(t){return e.$emit("select-stepe","checkstatus")}}},[e._v(" Retour ")])])},$=[],U={modelsFields:{},string(e,t,s=[]){0===s.length&&s.push({value:""});const a=[];a.push(e("label",{class:["d-block","content-center__title"]},[t.label_value])),s.forEach((t=>{a.push(e("input",{props:{type:"text",value:t.value,b_input:{type:Object,required:!0}},on:{input:function(e){e.target&&e.target.value&&(t.value=e.target.value)}},class:["form-control"]}))})),a.push(e("small",{class:["text-muted"]},[t.description]));const o=e("div",{props:{},class:["form-group","content-center__input"]},a);return o}};class O{constructor(e,t){this.entity=e,this.bundle=t}async format(){var e=await this.getFields();return new Promise(((t,s)=>{if(e.data&&e.data.fields){U.modelsFields=this.buildModel(e.data.fields);const s=[];for(const t in e.data.fields)s.push({ref:t,props:{name:{type:String,default:e.data.fields[t].name}},render(s){var a=[];switch(e.data.fields[t].type){case"string":a.push(U.string(s,e.data.fields[t],U.modelsFields[t]));break}return s("div",a)}});t({templates:s,models:U.modelsFields})}else s("Aucune donnée disponible")}))}getFields(){var e="/api/form-node/generate-form";return"user"===this.entity&&(e="/api/form-node/generate-user"),e+="/"+this.bundle,m.Z.get(e)}buildModel(e){const t={};for(const s in e)e[s].type&&(t[s]=[]);return t}}var I=O,A={name:"checkstatus",props:{urlLogo:{type:String,required:!0},form:{type:Object,required:!0},formValidate:{type:Object,required:!0},showPassword:{type:Boolean,default:!1},action_after_login:{type:String,required:!0},model_register_form:{type:String,required:!0}},components:{svgWaiting:()=>s.e(324).then(s.bind(s,5324))},data(){return{messages:u.messages,waiting:"",templates:[]}},mounted(){this.showPassword?void 0===this.form.password&&this.$set(this.form,"password",[{value:""}]):this.form.password&&delete this.form.password,this.getFields()},methods:{async generatePassword(){this.waiting="wait";var e="/login-rx-vuejs/genrate-password";const t=await this.formValidate.validate();t?m.Z.post(e,this.form).then((e=>{console.log("resp : ",e),this.waiting="",u.AfterRedirect(this.action_after_login,e)})).catch((()=>{this.waiting=""})):(this.waiting="",console.log("echec de validation de mail"))},async RegisterDefault(){this.waiting="wait";var e="/user/register?_format=json";const t=await this.formValidate.validate();t?m.Z.post(e,this.form).then((e=>{console.log("resp : ",e),this.waiting="",u.modalSuccess(u.msgCreate([this.messages.devisCreateUser]),{title:"Votre compte a été crré",footerClass:"d-none",headerBgVariant:"success",headerTextVariant:"light"}).then((()=>{u.AfterRedirect(this.action_after_login,e)}))})).catch((e=>{if(this.waiting="",e.error&&e.error.data&&e.error.data.errors){const t=e.error.data.errors;t.forEach((e=>{const t=e.split(":");this.$refs[t[0]]&&(this.$refs[t[0]][0]?this.$refs[t[0]][0].setErrors([t[1]]):this.$refs[t[0]].setErrors([t[1]]))}))}})):this.waiting=""},getFields(){const e=new I("user","user");e.format().then((e=>{this.templates=e.templates;for(const t in e.models)this.$set(this.form,t,e.models[t]);console.log("resp : ",e)}))},validEmail(e){var t=/\S+@\S+\.\S+/;return t.test(e)},set_email(){this.form.mail=this.form.name}}},Z=A,W=(0,y.Z)(Z,j,$,!1,null,null,null),D=W.exports,H={props:{action_after_login:{type:String,default:"default"},model_register_form:{type:String,default:"default"}},name:"LoginRegister",components:{},data(){return{messages:u.messages,waiting:"",form:{name:[{value:""}],mail:[{value:""}]},password:"",mail:"",stepe:E,models:{},baseURl:d.Z.baseURl,isBusy:!1,alertDisplay:!1,alertType:"alert-danger",alertText:"",urlLogo:window.location.origin+""+window.logo_current_theme,formValidate:{}}},mounted(){g.appId=889256191665205,this.TryToLoginWithFacebook(),g.chargement(),this.formValidate=this.$refs.formValidate},methods:{selectStepe(e){switch(e){case"checkstatus":this.stepe=E;break;case"setPassword":this.stepe=R;break;case"register":this.stepe=D;break}},TryToLoginWithFacebook(){document.addEventListener("wbu-fb-status-change",(()=>{this.isBusy=!0,this.getFields(),m.Z.post("/login-rx-vuejs/facebook-check",g.user).then((e=>{this.isBusy=!1,this.alertDisplay=!0,this.alertType="alert-success",this.alertText=" Connexion réussie  ",e.reponse&&e.reponse.config.url!==e.reponse.request.responseURL?window.location.assign(e.reponse.request.responseURL):e.data&&e.data.createuser?this.stepe="final-fb-register":window.location.assign(window.location.origin)})).catch((e=>{this.isBusy=!1,this.isBusy=!1,this.alertDisplay=!0,this.alertType="alert-danger",this.alertText="Facebook : Erreur de connexion ",e.error&&(this.alertText=e.error.statusText)}))}),!1)},IsBusy(){this.isBusy=!0,console.log("this.isbusy",this.isBusy)},async finalRegister(){this.waiting="wait";var e={},t="";"final-gl-register"===this.stepe?(t="/login-rx-vuejs/google-login",e={fields:this.models,google:[]}):"final-fb-register"===this.stepe&&(t="/login-rx-vuejs/facebook-login",e={fields:this.models,facebook:g.user});const s=await this.$refs.formValidate.validate();s&&m.Z.post(t,e).then((e=>{console.log(e),this.waiting="",e.reponse&&e.reponse.config.url!==e.reponse.request.responseURL&&window.location.assign(e.reponse.request.responseURL)}))}}},N=H,M=(0,y.Z)(N,a,o,!1,null,null,null),z=M.exports}}]);
//# sourceMappingURL=BuilderCv.umd.min.936.js.map